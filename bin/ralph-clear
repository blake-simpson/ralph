#!/bin/bash

# ralph-clear: Reset .ralph directory to start fresh

RALPH_DIR=".ralph"

if [ ! -d "$RALPH_DIR" ]; then
    echo "No .ralph directory found. Nothing to clear."
    echo ""
    echo "Run 'ralph-init' to initialize a new project."
    exit 0
fi

echo "Clearing Ralph state files..."

# Clear PRD.md with empty markdown template
cat > "$RALPH_DIR/PRD.md" << 'EOF'
# PRD: [Feature Name]

## Overview
[1-2 sentence description]

## Problem Statement
[What problem does this solve?]

## Success Criteria (Definition of Done)
- [ ] Criterion 1
- [ ] Criterion 2
- [ ] Criterion 3

## Acceptance Criteria (BDD)

### Scenario: [Scenario Name]
Given [context]
And [more context]
When [action]
Then [expected result]
And [additional assertions]

## Technical Approach
[High-level implementation strategy]

## Out of Scope
[What this feature explicitly does NOT include]

## Open Questions
[Questions that need answers before implementation]

## Clarifications
[Answers to open questions, added during planning]

---

## Technical Tasks

### P0-1: [Task Name]
**Severity**: CRITICAL
**File**: [file path]

**Problem**: [What's wrong]

**Solution**: [How to fix]

**Verification**:
1. `npm run lint:fix`
2. `npx tsc --noEmit`
3. [Additional verification steps]

---

## Summary Statistics

| Severity | Count | Status |
|----------|-------|--------|
| CRITICAL (P0) | 0 | Pending |
| HIGH (P1) | 0 | Pending |
| MEDIUM (P2) | 0 | Pending |
| **Total** | **0** | |

## Agent Instructions

Before implementing ANY task:
1. Load skills: `frontend-design`, `vercel-react-best-practices`, `vibesec`
2. Read the full task description including Implementation Details
3. Follow the verification steps exactly
4. Mark task complete by adding âœ… to the header
EOF
echo "  Cleared: $RALPH_DIR/PRD.md"

# Clear PROGRESS.md with empty markdown template
cat > "$RALPH_DIR/PROGRESS.md" << 'EOF'
# Progress: [Feature Name]

## Status: ðŸ”´ Not Started

## PRD Reference
.ralph/PRD.md

## Milestones

### â¬œ M1: [Milestone Name]
- [ ] Task 1
- [ ] Task 2

## Definition of Done Checklist
- [ ] DoD Item 1
- [ ] DoD Item 2

## Session History
| Session | Date | Context Used | Tasks Completed |
|---------|------|--------------|-----------------|

## Decisions Log
[Numbered list of key decisions with rationale]

## Blockers
[Any blocking issues]
EOF
echo "  Cleared: $RALPH_DIR/PROGRESS.md"

# Remove TECH_PLAN.md if it exists
if [ -f "$RALPH_DIR/TECH_PLAN.md" ]; then
    rm "$RALPH_DIR/TECH_PLAN.md"
    echo "  Removed: $RALPH_DIR/TECH_PLAN.md"
fi

# Reset active tasks
echo "[]" > "$RALPH_DIR/ralph-active.json"
echo "  Cleared: $RALPH_DIR/ralph-active.json"

echo ""
echo "Done! Ready to start a new project cycle."
echo "Run 'ralph-plan' to create your PRD."
