#!/bin/bash

# ralph-clear: Reset PRD.md and PROGRESS.md to start fresh

PRD_DIR="$HOME/.local/ralph"
PRD_FILE="$PRD_DIR/PRD.md"
PROGRESS_FILE="$PRD_DIR/PROGRESS.md"
TECH_PLAN_FILE="$PRD_DIR/TECH_PLAN.md"

# Create directory if it doesn't exist
mkdir -p "$PRD_DIR"

echo "Clearing Ralph state files..."

# Clear PRD.md with empty markdown template
cat > "$PRD_FILE" << 'EOF'
# PRD: [Feature Name]

## Overview
[1-2 sentence description]

## Problem Statement
[What problem does this solve?]

## Success Criteria (Definition of Done)
- [ ] Criterion 1
- [ ] Criterion 2
- [ ] Criterion 3

## Acceptance Criteria (BDD)

### Scenario: [Scenario Name]
Given [context]
And [more context]
When [action]
Then [expected result]
And [additional assertions]

## Technical Approach
[High-level implementation strategy]

## Out of Scope
[What this feature explicitly does NOT include]

## Open Questions
[Questions that need answers before implementation]

## Clarifications
[Answers to open questions, added during planning]

---

## Technical Tasks

### P0-1: [Task Name]
**Severity**: CRITICAL
**File**: [file path]

**Problem**: [What's wrong]

**Solution**: [How to fix]

**Verification**:
1. `npm run lint:fix`
2. `npx tsc --noEmit`
3. [Additional verification steps]

---

## Summary Statistics

| Severity | Count | Status |
|----------|-------|--------|
| CRITICAL (P0) | 0 | Pending |
| HIGH (P1) | 0 | Pending |
| MEDIUM (P2) | 0 | Pending |
| **Total** | **0** | |

## Agent Instructions

Before implementing ANY task:
1. Load skills: `frontend-design`, `vercel-react-best-practices`, `vibesec`
2. Read the full task description including Implementation Details
3. Follow the verification steps exactly
4. Mark task complete by adding âœ… to the header
EOF
echo "  Cleared: $PRD_FILE"

# Clear PROGRESS.md with empty markdown template
cat > "$PROGRESS_FILE" << 'EOF'
# Progress: [Feature Name]

## Status: ðŸ”´ Not Started

## PRD Reference
~/.local/ralph/PRD.md

## Milestones

### â¬œ M1: [Milestone Name]
- [ ] Task 1
- [ ] Task 2

## Definition of Done Checklist
- [ ] DoD Item 1
- [ ] DoD Item 2

## Session History
| Session | Date | Context Used | Tasks Completed |
|---------|------|--------------|-----------------|

## Decisions Log
[Numbered list of key decisions with rationale]

## Blockers
[Any blocking issues]
EOF
echo "  Cleared: $PROGRESS_FILE"

# Remove TECH_PLAN.md if it exists
if [ -f "$TECH_PLAN_FILE" ]; then
    rm "$TECH_PLAN_FILE"
    echo "  Removed: $TECH_PLAN_FILE"
fi

echo ""
echo "Done! Ready to start a new project cycle."
echo "Run 'ralph-plan' to create your PRD."
